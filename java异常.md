# 异常

什么是异常？

异常本质上就是程序的错误

## 程序中的异常

错误在我们编写程序的过程重金常发生，包括编译期间和运行期间的错误。

在编译期间出现的错误由编译器帮助我们一起修正，然而运行期间的错误便不是编译器力所能及了，并且运行期间的错误往往是难以预料的。

常见的例子有![](F:\md笔记文件\javaimg\常见的异常错误.png)

程序中的出现了异常，如果置之不理，程序可能会不正常运行，强制终端运行，造成用户数据丢失，资源无法正常释放，直接导致系统崩溃，显然这不是我们希望看到的结果。

java提供了异常机制来进行处理，通过异常机制，我们可以更好地提升程序的健壮性。

在Java中，通过Throwable及其子类描述各种不同的异常类型。

![](F:\md笔记文件\javaimg\Throwable异常.png)

**Throwable有两个重要的子类：Exception和Error**

### **Error**

是程序无法处理的错误，表示运行应用程序中较严重问题。大多数错误与代码编写者执行的操作无关，而表示代码运行时JVM出现的问题。

例如Java虚拟机运行错误(Virtual MachineError),当JVM不再有继续执行操作所需的内存资源时,将出现OutOfMemoryError。

这些错误是不可查的，因为他们在应用程序的控制和处理能力之外，而且绝大多数是程序运行时不允许出现的状况。

对于设计合理的应用程序来说，即使确实发生了错误，本质上也不应该试图去处理他所引起的异常状况。

因此我们编写程序时不需要关心这些异常类

### Exception

Exception是程序本身可以处理的异常。异常处理通常指针对这种类型异常的处理。

Exception类的异常包括checked exception 和unchecked exception。

#### unchecked exception

编译器不强制处置的异常

包括RuntimeException类及其子类异常。

如NullPointException（空指针异常）等，些异常是unchecked exception。

Java编译器不会检查这些异常，在程序中可以选择捕获处理，也可以不处理，照样正常编译通过。

#### checked exception

checked exception ：编译器要求必须处置的异常。

Runtime Exception及其子类以外，其他的Exception类的子类。

如IOException、SQLException等

Java编译器会检查这些异常，当程序中可能出现这类异常时，要求必须进行异常处理，否则编译不会通过。

### 异常处理

在Java中，异常处理机制为：抛出异常、捕捉异常

#### 抛出异常

当一个方法出现错误引发异常时，方法创建异常对象并交付运行时系统。

异常对象中包含了异常类型和异常出现时的程序状态等异常信息。

运行时系统负责寻找处置异常的代码并执行。

#### 捕获异常

在方法抛出异常之后，运行时系统将转为寻找合适的异常处理器。

运行时系统从发生异常的方法开始，依次回查调用栈中的方法，当异常处理器所能处理的异常类型与方法抛出的异常类型相符时，即为合适的异常处理器。

当运行时系统遍历调用栈而未找到合适的异常处理器，则运行时系统终止。同时意味着Java程序的终止。

对于运行时异常、错误或可查异常，Java技术所要求的异常处理方式有所不同。

总体来说，Java规定：对于可查异常必须捕捉、或者声明抛出。允许忽略不可查的RuntimeException和Error。

**简单来说异常总是先被抛出，后被捕捉的**

#### 异常处理

通过5个关键字来实现：try、catch、finally、throw、throws

![](F:\md笔记文件\javaimg\异常处理.png)

```java
//try-catch-finally
public void method(){
    try{
        //代码段1
        //产生异常的代码段2
    }catch(异常类型 ex){
        //对异常进行处理的代码段3
    }finally{
        //代码段4
    }
}
```

try-catch使用try-catch块捕获并处理异常

```java
public void method(){
	try{
        //代码段
    }catch(异常类型 ex){
        //对异常进行处理的代码段
    }
    //代码段
}
```

无异常情况

![](F:\md笔记文件\javaimg\无异常.png)

有异常并能正常匹配处理情况

![有异常并能正常匹配处理](F:\md笔记文件\javaimg\有异常并能正常匹配处理.png)

有异常不能正常匹配处理情况

![](F:\md笔记文件\javaimg\有异常不能正常匹配处理.png)

##### 多重catch块

一旦某个catch 捕获到匹配的异常类型，将进入异常处理代码。一经处理结束，就意味着整个try-catch语句结束。其他的catch子句不再有匹配和捕获异常类型的机会。

对于有多个catch子句的一场程序而言，应该尽量捕获底层异常类的catch子句放在前面，同时尽量将捕获相对高层的异常类的catch子句放在后面。否则，捕获底层异常类的catch子句将可能会被屏蔽。

引发多种类型的异常

排列catch语句的顺序：先子类后父类

发生异常时按顺序逐个匹配

只执行第一个与异常类型匹配的catch语句![](F:\md笔记文件\javaimg\多重catch块.png)

try块后可以接零个或多个catch块，如果没有catch，则必须跟一个finally块

在try-catch块后加入finally块，不管是否异常都执行

不执行的唯一情况：

![](F:\md笔记文件\javaimg\finally不执行的唯一情况.png)

## **常见的异常类型**

![](F:\md笔记文件\javaimg\常见异常类型.png)

try-catch-finally总结

- 处理运行异常时，采用逻辑去合理规避同时辅助try-catch处理
- 在多重zatch块后面，可以加一个catch(Exception)来处理可能会被遗漏的异常
- 对于不确定的代码，也可以加上trycatch，处理潜在的异常
- 尽量去处理异常，切记只是简单的调用printStaceTrace()去打印输出
- 具体如何处理异常要根据不同的业务需求和异常类型去决定
- 尽量添加finally语句块去释放占用的资源

## throw&throws

可以通过throws声明将要抛出何种类型的异常，通过throw将产生的异常抛出

throws如果一个方法可能会出现异常，但没有能力处理这种异常，可以在方法声明处用throws子句来声明抛出异常。

thorows语句用在方法定义时声明该方法要抛出的异常类型

```java
public void method()throws Exception1,Exception2....ExceptionN{
    //坑内产生异常的代码
}
```

当方法抛出异常列表中的异常时，方法将不对这些类型及其子类类型的异常做处理，而抛向调用该方法的方法，由他去处理。

### throws使用规则

1. 如果是不可查异常（unchecked exception），即Error、RuntimeException或他们的子类，那么可以不使用throws关键字来声明要抛出的异常，编译仍能顺利通过，但在运行时会被系统抛出。
2. 如果一个方法中可能出现可查异常，那没用try-catch语句捕获，那没用throws子句声明将它抛出，否则会导致编译错误
3. 当抛出了异常，则该方法的调用者必须处理或者重新抛出该异常。
4. 当子类重写父类抛出异常的方法时，声明的异常方法必须是父类方法所声明异常的同类或子类。

### throw

用来抛出一个异常

**finally代码块：通常用于关闭资源。**